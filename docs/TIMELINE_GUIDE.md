# 时间轴动画系统使用指南

## 基本概念

### 什么是时间轴动画？

时间轴动画是一种基于**关键帧**的动画制作方式。你只需要在特定的时间点设置物体的状态（位置、旋转、缩放等），系统会自动计算中间帧，生成流畅的动画效果。

### 核心概念

| 概念 | 说明 |
|------|------|
| **动画剪辑 (Clip)** | 一段完整的动画，包含多个轨道。类似视频剪辑。 |
| **轨道 (Track)** | 控制某个物体的某个属性（如位置X、旋转Y等）的动画数据。 |
| **关键帧 (Keyframe)** | 在特定时间点记录的属性值。系统会在关键帧之间自动插值。 |
| **播放指针** | 红色的竖线，表示当前播放/预览的时间位置。 |
| **插值 (Interpolation)** | 计算两个关键帧之间的过渡值，使动画平滑。 |

---

## 界面介绍

### 打开时间轴

1. 点击底部面板的 **"时间轴"** 标签页
2. 如果面板是折叠的，点击后会自动展开

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  [控制栏] ⏮ ⏪ ▶ ⏹ ⏩ ⏭  | 00:02.50 / 00:10.00 | 🔁 1x ➖ 100% ➕  │
├─────────────────────────────────────────────────────────────┤
│ 轨道        │ 0s      2s      4s      6s      8s     10s   │
├─────────────┼───────────────────────────────────────────────┤
│ ▼ Cube      │                     ▼ 播放指针                │
│   position  │ ◆─────────◆─────────────────◆                │
│   rotation  │ ◆─────────────────◆─────────◆                │
│   scale     │ ◆─────────────────────────────◆              │
├─────────────┼───────────────────────────────────────────────┤
│ ▼ Sphere    │                                               │
│   position  │ ◆───────────────────────────────◆            │
└─────────────┴───────────────────────────────────────────────┘
```

#### 控制栏（顶部）

| 按钮 | 功能 |
|------|------|
| ⏮ | 跳到动画开始 |
| ⏪ | 跳到上一个关键帧 |
| ▶/⏸ | 播放/暂停 |
| ⏹ | 停止（回到开始） |
| ⏩ | 跳到下一个关键帧 |
| ⏭ | 跳到动画结束 |
| 🔁 | 循环播放开关 |
| 1x | 播放速度（0.25x ~ 2x） |
| ➖/➕ | 缩小/放大时间轴 |

#### 左侧轨道标签

- 显示物体名称和属性名称
- 每个属性旁边有开关，可以启用/禁用该轨道

#### 右侧时间轴区域

- 顶部是时间刻度
- ◆ 菱形图标是关键帧
- 红色竖线是播放指针

---

## 基本操作

### 1. 创建动画

如果没有动画剪辑，会显示 **"暂无动画剪辑"** 提示：

1. 点击 **"创建动画"** 按钮
2. 系统会创建一个默认 10 秒的动画剪辑

### 2. 添加关键帧

**方法一：使用工具栏**
1. 在场景中选择一个物体
2. 移动播放指针到目标时间位置（点击时间轴或拖拽红色指针）
3. 调整物体的位置、旋转或缩放
4. 点击控制栏的 **"添加关键帧"** 按钮

**方法二：使用快捷键**
1. 选择物体，调整属性
2. 按 **K** 键添加关键帧

### 3. 编辑关键帧

| 操作 | 方法 |
|------|------|
| **选择关键帧** | 点击关键帧（◆） |
| **多选关键帧** | Shift + 点击 |
| **移动关键帧** | 拖拽关键帧到新位置 |
| **删除关键帧** | 选中后按 Delete 或 Backspace |

### 4. 播放预览

- 点击 **▶ 播放** 按钮
- 或按 **空格键** 播放/暂停
- 动画会在场景中实时预览

### 5. 时间导航

| 操作 | 方法 |
|------|------|
| **跳转到指定时间** | 点击时间轴上的位置 |
| **拖拽播放指针** | 拖动红色指针 |
| **前进一帧** | 按 → 方向键 |
| **后退一帧** | 按 ← 方向键 |
| **跳到上一个关键帧** | Shift + ← |
| **跳到下一个关键帧** | Shift + → |
| **跳到开始** | Home 键 |
| **跳到结束** | End 键 |

### 6. 缩放时间轴

- 使用控制栏的 ➖/➕ 按钮
- 或 **Ctrl + 鼠标滚轮** 缩放

---

## 快捷键速查表

| 快捷键 | 功能 |
|--------|------|
| **空格** | 播放/暂停 |
| **K** | 为选中物体添加关键帧 |
| **Delete / Backspace** | 删除选中的关键帧 |
| **←** | 后退一帧 |
| **→** | 前进一帧 |
| **Shift + ←** | 跳到上一个关键帧 |
| **Shift + →** | 跳到下一个关键帧 |
| **Home** | 跳到开始 |
| **End** | 跳到结束 |
| **Ctrl + 滚轮** | 缩放时间轴 |

---

## 动画示例：制作一个旋转的立方体

### 步骤 1：准备场景
1. 在场景中添加一个立方体（Cube）
2. 打开底部的时间轴面板

### 步骤 2：创建动画剪辑
1. 点击 **"创建动画"** 按钮

### 步骤 3：设置起始关键帧
1. 确保播放指针在 **0 秒** 位置
2. 选中立方体
3. 按 **K** 键添加关键帧

### 步骤 4：设置结束关键帧
1. 点击时间轴，将播放指针移动到 **5 秒** 位置
2. 在右侧属性面板中，将立方体的 **Y 旋转** 改为 **360°**
3. 按 **K** 键添加关键帧

### 步骤 5：预览动画
1. 按 **空格键** 或点击播放按钮
2. 立方体会在 5 秒内旋转一圈

### 步骤 6：设置循环
1. 点击控制栏的 **🔁 循环** 按钮
2. 动画会持续循环播放

---

## 进阶技巧

### 1. 缓动曲线（Easing）

关键帧之间的过渡可以使用不同的缓动效果：

| 缓动类型 | 效果 |
|----------|------|
| **linear** | 匀速运动 |
| **easeIn** | 慢进快出（加速） |
| **easeOut** | 快进慢出（减速） |
| **easeInOut** | 慢进慢出（平滑） |

### 2. 多轨道动画

一个物体可以同时有多个轨道：
- **position** - 位置动画
- **rotation** - 旋转动画
- **scale** - 缩放动画

这些轨道可以独立编辑，最终会合成在一起。

### 3. 禁用轨道

在调试动画时，可以临时禁用某个轨道：
- 点击轨道标签旁边的开关
- 禁用的轨道不会影响物体

---

## 常见问题

### Q: 为什么添加关键帧没有反应？

A: 请确保：
1. 已经创建了动画剪辑
2. 在场景中选中了一个物体
3. 物体有可动画的属性

### Q: 如何修改动画时长？

A: 目前默认时长为 10 秒。可以通过代码修改：
```typescript
animationStore.updateClip(clipId, { duration: 20 }) // 改为 20 秒
```

### Q: 动画播放卡顿怎么办？

A: 可能的原因：
1. 场景中物体过多
2. 关键帧数量过多
3. 尝试降低播放速度或减少动画复杂度

### Q: 如何删除整个动画剪辑？

A: 使用代码：
```typescript
animationStore.deleteClip(clipId)
```

---

## 技术说明

### 支持的属性

| 属性 | 说明 |
|------|------|
| position | 位置 (x, y, z) |
| rotation | 旋转弧度 (x, y, z) |
| scale | 缩放 (x, y, z) |
| visible | 可见性 |
| opacity | 透明度（材质） |
| color | 颜色（材质） |

### 数据结构

```typescript
// 动画剪辑
interface AnimationClip {
  id: string
  name: string
  duration: number      // 时长（秒）
  fps: number           // 帧率（默认30）
  loop: boolean         // 是否循环
  tracks: AnimationTrack[]
}

// 动画轨道
interface AnimationTrack {
  id: string
  targetId: string      // 目标物体ID
  property: string      // 属性路径
  keyframes: Keyframe[]
}

// 关键帧
interface Keyframe {
  id: string
  time: number          // 时间点（秒）
  value: any            // 属性值
  easing: string        // 缓动类型
}
```

---

## 更新日志

- **v1.0** - 基础时间轴功能
  - 动画剪辑管理
  - 关键帧编辑
  - 播放控制
  - 快捷键支持
